<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math Practice Pro</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 16px; background: #f5f5f5; }
    h1 { text-align: center; color: #333; }
    .menu, .question-area { max-width: 480px; margin: auto; }
    button { 
      width: 100%; padding: 16px; margin: 8px 0; font-size: 18px; 
      cursor: pointer; border-radius: 12px; border: 1px solid #ccc; 
      background-color: white; transition: 0.2s;
    }
    button:active { background-color: #eee; }
    .btn-sheet { background-color: #34a853; color: white; font-weight: bold; border: none; }
    .btn-custom { background-color: #9c27b0; color: white; font-weight: bold; border: none; }
    .question { font-size: 32px; text-align: center; margin: 24px 0; font-weight: bold; min-height: 40px; }
    .answer { font-size: 28px; text-align: center; color: #d93025; margin: 16px 0; display: none; font-weight: bold; }
    .timer { text-align: center; font-size: 20px; color: #666; }
    .loading { font-style: italic; color: #888; text-align: center; display: none; margin-top: 10px; }
  </style>
</head>
<body>

<h1>Math Practice</h1>

<div class="menu" id="menu">
  <button onclick="startMode('m12')">Multiplication 2‚Äì12</button>
  <button onclick="startMode('m2x1')">2-Digit √ó 1-Digit</button>
  <button onclick="startMode('m2x2')">2-Digit √ó 2-Digit</button>
  <button onclick="startMode('add3')">3-Digit Addition</button>
  <button onclick="startMode('sub3')">3-Digit Subtraction</button>
  
  <button class="btn-custom" onclick="startSheetMode()">üìù Custom Questions (from Sheet)</button>
  <div id="loadingMsg" class="loading">Fetching questions...</div>

  <button class="btn-sheet" onclick="window.open('https://docs.google.com/spreadsheets/d/e/2PACX-1vT4Dugmd2CtGnRreZoVHbDqlNiWi6t-xxMgIvoyU8KW1ueQxtL3TiI9YKuHcIjXNSd_Zkqf8V6VxaeE/pubhtml', '_blank')">
    üìä Open Google Sheet
  </button>
</div>

<div class="question-area" id="questionArea" style="display:none;">
  <div class="timer" id="timer"></div>
  <div class="question" id="question"></div>
  <div class="answer" id="answer"></div>
  <button onclick="showAnswer()" style="background-color: #4285f4; color: white; border: none;">Show Answer</button>
  <button onclick="nextQuestion()">Next Question</button>
  <button onclick="backToMenu()" style="background-color: #eee;">Back to Menu</button>
</div>

<script>
  let currentMode = null;
  let countdown = null;
  let timeLeft = 0;
  let sheetQuestions = [];
  let isSheetMode = false;

  const modes = {
    m12: { minA: 2, maxA: 12, minB: 2, maxB: 12, op: '√ó', time: 8 },
    m2x1: { minA: 10, maxA: 99, minB: 2, maxB: 9, op: '√ó', time: 10 },
    m2x2: { minA: 10, maxA: 99, minB: 10, maxB: 99, op: '√ó', time: 12 },
    add3: { minA: 100, maxA: 999, minB: 100, maxB: 999, op: '+', time: 15 },
    sub3: { minA: 100, maxA: 999, minB: 100, maxB: 999, op: '-', time: 15 }
  };

  // --- GOOGLE SHEETS LOGIC ---
  async function startSheetMode() {
    const loadingMsg = document.getElementById('loadingMsg');
    loadingMsg.style.display = 'block';
    
    // Using your provided CSV link
    const csvUrl = `https://docs.google.com/spreadsheets/d/e/2PACX-1vT4Dugmd2CtGnRreZoVHbDqlNiWi6t-xxMgIvoyU8KW1ueQxtL3TiI9YKuHcIjXNSd_Zkqf8V6VxaeE/pub?output=csv`;

    try {
      const response = await fetch(csvUrl);
      const data = await response.text();
      
      // Simple CSV parser
      const rows = data.split('\n').map(row => row.split(','));
      
      sheetQuestions = rows.map(cols => ({
        q: cols[0] ? cols[0].trim() : "",
        a: cols[1] ? cols[1].trim() : ""
      })).filter(item => item.q !== "" && item.q.toLowerCase() !== "question"); // Skip header and empty rows

      if (sheetQuestions.length > 0) {
        isSheetMode = true;
        document.getElementById('menu').style.display = 'none';
        document.getElementById('questionArea').style.display = 'block';
        nextQuestion();
      } else {
        alert("No questions found. Ensure your sheet has data in Column A and B.");
      }
    } catch (error) {
      alert("Error accessing sheet. Verify that it is 'Published to Web' as a CSV.");
    } finally {
      loadingMsg.style.display = 'none';
    }
  }

  // --- CORE APP LOGIC ---
  function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

  function startMode(modeKey) {
    isSheetMode = false;
    currentMode = modes[modeKey];
    document.getElementById('menu').style.display = 'none';
    document.getElementById('questionArea').style.display = 'block';
    nextQuestion();
  }

  function nextQuestion() {
    clearInterval(countdown);
    document.getElementById('answer').style.display = 'none';
    let qText, aText, speakText;

    if (isSheetMode) {
      let randomIdx = Math.floor(Math.random() * sheetQuestions.length);
      qText = sheetQuestions[randomIdx].q;
      aText = sheetQuestions[randomIdx].a;
      speakText = qText;
      startTimer(15); 
    } else {
      let a = rand(currentMode.minA, currentMode.maxA);
      let b = rand(currentMode.minB, currentMode.maxB);
      if (currentMode.op === '-' && b > a) [a, b] = [b, a];
      
      if (currentMode.op === '√ó') aText = a * b;
      if (currentMode.op === '+') aText = a + b;
      if (currentMode.op === '-') aText = a - b;
      
      qText = `${a} ${currentMode.op} ${b}`;
      speakText = questionToSpeech(a, b, currentMode.op);
      startTimer(currentMode.time);
    }

    document.getElementById('question').textContent = qText;
    document.getElementById('answer').textContent = aText;
    speak(speakText);
  }

  function questionToSpeech(a, b, op) {
    if (op === '√ó') return `${a} times ${b}`;
    if (op === '+') return `${a} plus ${b}`;
    if (op === '-') return `${a} minus ${b}`;
  }

  function startTimer(seconds) {
    timeLeft = seconds;
    document.getElementById('timer').textContent = `Time: ${timeLeft}`;
    countdown = setInterval(() => {
      timeLeft--;
      document.getElementById('timer').textContent = `Time: ${timeLeft}`;
      if (timeLeft <= 0) {
        clearInterval(countdown);
        document.getElementById('timer').textContent = "Time Up!";
      }
    }, 1000);
  }

  function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 0.9;
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  }

  function showAnswer() { document.getElementById('answer').style.display = 'block'; }

  function backToMenu() {
    clearInterval(countdown);
    document.getElementById('questionArea').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
  }
</script>
</body>
</html>